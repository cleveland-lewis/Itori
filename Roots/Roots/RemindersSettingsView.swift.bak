import SwiftUI
import EventKit

struct RemindersSettingsView: View {
    @EnvironmentObject var calendarManager: CalendarManager

    var body: some View {
        Form {
            Section("Reminders") {
                Toggle("Enable Reminders Sync", isOn: Binding(
                    get: { calendarManager.reminderAuthorizationStatus == .authorized || calendarManager.reminderAuthorizationStatus == .fullAccess },
                    set: { newValue in
                        if newValue { _Concurrency.Task { await calendarManager.requestRemindersAccess() } }
                    }
                ))
                .toggleStyle(.switch)
                .onChange(of: calendarManager.reminderAuthorizationStatus) { _, _ in /* UI updates via calendarManager published */ }

                HStack {
                    Text("Status:")
                        .foregroundStyle(.secondary)
                    if calendarManager.reminderAuthorizationStatus == .authorized || calendarManager.reminderAuthorizationStatus == .fullAccess {
                        Text("Connected").foregroundStyle(.green)
                    } else if calendarManager.isRemindersAccessDenied {
                        Text("Access Denied").foregroundStyle(.red)
                        Button("Open Settings") { calendarManager.openSystemPrivacySettings() }
                            .buttonStyle(.link)
                    } else {
                        Text("Not Connected").foregroundStyle(.secondary)
                    }
                }
                .font(.caption)
            }
        }
        .formStyle(.grouped)
    }
}